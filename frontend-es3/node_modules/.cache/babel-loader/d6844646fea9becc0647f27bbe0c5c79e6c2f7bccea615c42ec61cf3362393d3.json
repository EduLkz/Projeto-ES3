{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import QrScanner from'qr-scanner';import'./qrcode.css';import{useDispatch,useSelector}from'react-redux';import{setDriverCoord}from'./slices/logSlice';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";export default function QRCodeReader(){const driverCoord=useSelector(state=>state.isLogged.driverCoord);const dispatch=useDispatch();const videoRef=useRef(null);const qrScannerRef=useRef(null);const[result,setResult]=useState('');const[hasCamera,setHasCamera]=useState(true);const[cameraActive,setCameraActive]=useState(false);useEffect(()=>{QrScanner.hasCamera().then(hasCamera=>{setHasCamera(hasCamera);});return()=>{if(qrScannerRef.current){qrScannerRef.current.stop();qrScannerRef.current.destroy();qrScannerRef.current=null;}};},[]);const startScanner=()=>{if(!videoRef.current)return;qrScannerRef.current=new QrScanner(videoRef.current,result=>{dispatch(setDriverCoord([...driverCoord,result.data]));qrScannerRef.current.stop();setCameraActive(false);},{preferredCamera:'environment',highlightScanRegion:true,highlightCodeOutline:true,maxScansPerSecond:5});qrScannerRef.current.start().then(()=>setCameraActive(true)).catch(err=>{console.error(err);setHasCamera(false);});};const stopScanner=()=>{if(qrScannerRef.current){qrScannerRef.current.stop();setCameraActive(false);}};const toggleScanner=()=>{cameraActive?stopScanner():startScanner();};return/*#__PURE__*/_jsxs(\"div\",{className:\"qr-scanner-container\",children:[!hasCamera?/*#__PURE__*/_jsx(\"p\",{children:\"Nenhuma camera encontrada\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"video-container\",children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,playsInline:true,className:\"video-element\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleScanner,className:\"scanner-button \".concat(cameraActive?'stop-button':'start-button'),children:cameraActive?'Parar leitura':'Iniciar Leitura'})]}),result&&/*#__PURE__*/_jsxs(\"div\",{className:\"result-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Resultado:\"}),/*#__PURE__*/_jsx(\"p\",{className:\"result-text\",children:result}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setResult(''),className:\"scanner-button clear-button\",children:\"Limpar\"})]})]});}","map":{"version":3,"names":["React","useEffect","useRef","useState","QrScanner","useDispatch","useSelector","setDriverCoord","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","QRCodeReader","driverCoord","state","isLogged","dispatch","videoRef","qrScannerRef","result","setResult","hasCamera","setHasCamera","cameraActive","setCameraActive","then","current","stop","destroy","startScanner","data","preferredCamera","highlightScanRegion","highlightCodeOutline","maxScansPerSecond","start","catch","err","console","error","stopScanner","toggleScanner","className","children","ref","playsInline","onClick","concat"],"sources":["/mnt/Main/Code/ES3/frontend-es3/src/QRCodeReader.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react'\nimport QrScanner from 'qr-scanner'\nimport './qrcode.css'\nimport { useDispatch, useSelector } from 'react-redux';\nimport { setDriverCoord } from './slices/logSlice';\n\nexport default function QRCodeReader() {\n\n    const driverCoord = useSelector(state => state.isLogged.driverCoord)\n    \n    const dispatch = useDispatch();\n    const videoRef = useRef(null);\n    const qrScannerRef = useRef(null)\n\n    const [result, setResult] = useState('')\n\n    const [hasCamera, setHasCamera] = useState(true)\n    const [cameraActive, setCameraActive] = useState(false)\n\n    useEffect(() => {\n        QrScanner.hasCamera().then(hasCamera =>{\n            setHasCamera(hasCamera)\n        })\n\n        return () => {\n            if(qrScannerRef.current){\n                qrScannerRef.current.stop()\n                qrScannerRef.current.destroy()\n                qrScannerRef.current = null;\n            }\n        };\n    }, [])\n\n    const startScanner = () => {\n        if(!videoRef.current) return;\n\n        qrScannerRef.current = new QrScanner(\n            videoRef.current,\n            (result) => {\n                dispatch(setDriverCoord([...driverCoord, result.data]))\n                qrScannerRef.current.stop()\n                setCameraActive(false)\n            },\n            {\n                preferredCamera: 'environment',\n                highlightScanRegion: true,\n                highlightCodeOutline: true,\n                maxScansPerSecond: 5\n            }\n        );\n\n        qrScannerRef.current.start()\n            .then(() => setCameraActive(true))\n            .catch((err) => {\n                console.error(err);\n                setHasCamera(false);\n            })\n    }\n\n    const stopScanner = () => {\n        if(qrScannerRef.current){\n            qrScannerRef.current.stop()\n            setCameraActive(false)\n        }\n    }\n\n    const toggleScanner = () => {\n        (cameraActive) ? stopScanner() : startScanner();\n    }\n\n  return (\n    <div className=\"qr-scanner-container\">\n\n        {!hasCamera ? (\n            <p>Nenhuma camera encontrada</p>\n        ) : (\n            <>\n                <div className='video-container'>\n                    <video ref={videoRef} playsInline className='video-element'/>\n                </div>\n\n                <button onClick={toggleScanner} \n                    className={`scanner-button ${cameraActive ? 'stop-button' : 'start-button'}`} >\n                    {cameraActive ? 'Parar leitura' : 'Iniciar Leitura'}\n                </button>\n            </>\n        )}\n\n        {result && (\n            <div className=\"result-container\">\n                <h2>Resultado:</h2>\n                <p className=\"result-text\">{ result }</p>\n                <button onClick={() => setResult('')} className=\"scanner-button clear-button\">\n                    Limpar\n                </button>\n            </div> \n        )}\n    </div>\n  )\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}